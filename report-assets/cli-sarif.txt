{
  "version": "2.1.0",
  "$schema": "https://raw.githubusercontent.com/oasis-tcs/sarif-spec/main/sarif-2.1/schema/sarif-schema-2.1.0.json",
  "runs": [
    {
      "tool": {
        "driver": {
          "name": "MigrationPilot",
          "version": "1.1.0",
          "informationUri": "https://migrationpilot.dev",
          "rules": [
            {
              "id": "MP001",
              "name": "require-concurrent-index-creation",
              "shortDescription": {
                "text": "CREATE INDEX without CONCURRENTLY blocks all writes on the target table for the entire duration of index creation."
              },
              "defaultConfiguration": {
                "level": "error"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp001"
            },
            {
              "id": "MP002",
              "name": "require-check-not-null-pattern",
              "shortDescription": {
                "text": "ALTER TABLE ... SET NOT NULL requires a full table scan to validate. Use the CHECK constraint pattern instead for large tables."
              },
              "defaultConfiguration": {
                "level": "error"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp002"
            },
            {
              "id": "MP003",
              "name": "volatile-default-table-rewrite",
              "shortDescription": {
                "text": "ADD COLUMN with a volatile DEFAULT (e.g., now(), random()) causes a full table rewrite on PG < 11, and still evaluates per-row on PG 11+."
              },
              "defaultConfiguration": {
                "level": "error"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp003"
            },
            {
              "id": "MP004",
              "name": "require-lock-timeout",
              "shortDescription": {
                "text": "DDL operations should set lock_timeout to prevent blocking the lock queue indefinitely."
              },
              "defaultConfiguration": {
                "level": "error"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp004"
            },
            {
              "id": "MP005",
              "name": "require-not-valid-foreign-key",
              "shortDescription": {
                "text": "Adding a FK constraint without NOT VALID scans the entire table under ACCESS EXCLUSIVE lock."
              },
              "defaultConfiguration": {
                "level": "error"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp005"
            },
            {
              "id": "MP006",
              "name": "no-vacuum-full",
              "shortDescription": {
                "text": "VACUUM FULL rewrites the entire table under ACCESS EXCLUSIVE lock, blocking all reads and writes."
              },
              "defaultConfiguration": {
                "level": "error"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp006"
            },
            {
              "id": "MP007",
              "name": "no-column-type-change",
              "shortDescription": {
                "text": "ALTER COLUMN TYPE rewrites the entire table under ACCESS EXCLUSIVE lock. Use the expand-contract pattern instead."
              },
              "defaultConfiguration": {
                "level": "error"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp007"
            },
            {
              "id": "MP008",
              "name": "no-multi-ddl-transaction",
              "shortDescription": {
                "text": "Multiple DDL statements in a single transaction compound lock duration. Each DDL should run in its own transaction."
              },
              "defaultConfiguration": {
                "level": "error"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp008"
            },
            {
              "id": "MP009",
              "name": "require-drop-index-concurrently",
              "shortDescription": {
                "text": "DROP INDEX without CONCURRENTLY acquires ACCESS EXCLUSIVE lock, blocking all reads and writes."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp009"
            },
            {
              "id": "MP010",
              "name": "no-rename-column",
              "shortDescription": {
                "text": "RENAME COLUMN breaks application queries referencing the old column name. Prefer adding a new column and migrating data."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp010"
            },
            {
              "id": "MP011",
              "name": "unbatched-data-backfill",
              "shortDescription": {
                "text": "UPDATE without a WHERE clause or LIMIT pattern rewrites the entire table in a single transaction, generating massive WAL and holding locks."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp011"
            },
            {
              "id": "MP012",
              "name": "no-enum-add-value-in-transaction",
              "shortDescription": {
                "text": "ALTER TYPE ... ADD VALUE cannot run inside a transaction block on PG < 12. Even on PG 12+, enum modifications take ACCESS EXCLUSIVE on the type."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp012"
            },
            {
              "id": "MP015",
              "name": "no-add-column-serial",
              "shortDescription": {
                "text": "ADD COLUMN with SERIAL/BIGSERIAL creates implicit sequence and may rewrite table."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp015"
            },
            {
              "id": "MP016",
              "name": "require-index-on-fk",
              "shortDescription": {
                "text": "Foreign key columns should have an index to avoid sequential scans on cascading updates/deletes."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp016"
            },
            {
              "id": "MP017",
              "name": "no-drop-column",
              "shortDescription": {
                "text": "DROP COLUMN takes ACCESS EXCLUSIVE lock and may break running application code."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp017"
            },
            {
              "id": "MP018",
              "name": "no-force-set-not-null",
              "shortDescription": {
                "text": "SET NOT NULL without a pre-existing CHECK constraint scans the entire table under ACCESS EXCLUSIVE lock."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp018"
            },
            {
              "id": "MP020",
              "name": "require-statement-timeout",
              "shortDescription": {
                "text": "Long-running DDL should have a statement_timeout to prevent holding locks indefinitely."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp020"
            },
            {
              "id": "MP021",
              "name": "require-concurrent-reindex",
              "shortDescription": {
                "text": "REINDEX without CONCURRENTLY acquires ACCESS EXCLUSIVE lock (table) or SHARE lock (index), blocking queries. Use REINDEX CONCURRENTLY on PG 12+."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp021"
            },
            {
              "id": "MP022",
              "name": "no-drop-cascade",
              "shortDescription": {
                "text": "DROP ... CASCADE silently drops all dependent objects (views, foreign keys, policies). Always drop dependents explicitly."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp022"
            },
            {
              "id": "MP023",
              "name": "require-if-not-exists",
              "shortDescription": {
                "text": "CREATE TABLE/INDEX without IF NOT EXISTS will fail if the object already exists, making migrations non-idempotent."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp023"
            },
            {
              "id": "MP024",
              "name": "no-enum-value-removal",
              "shortDescription": {
                "text": "DROP TYPE destroys the enum and all columns using it. PostgreSQL has no ALTER TYPE ... DROP VALUE â€” removing enum values requires a full type recreation."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp024"
            },
            {
              "id": "MP025",
              "name": "ban-concurrent-in-transaction",
              "shortDescription": {
                "text": "CONCURRENTLY operations (CREATE INDEX, DROP INDEX, REINDEX) cannot run inside a transaction block. PostgreSQL will raise an ERROR at runtime."
              },
              "defaultConfiguration": {
                "level": "error"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp025"
            },
            {
              "id": "MP026",
              "name": "ban-drop-table",
              "shortDescription": {
                "text": "DROP TABLE permanently removes the table and all its data. Use with extreme caution in production."
              },
              "defaultConfiguration": {
                "level": "error"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp026"
            },
            {
              "id": "MP027",
              "name": "disallowed-unique-constraint",
              "shortDescription": {
                "text": "Adding a UNIQUE constraint directly scans the entire table under ACCESS EXCLUSIVE lock. Create the index concurrently first, then add the constraint USING INDEX."
              },
              "defaultConfiguration": {
                "level": "error"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp027"
            },
            {
              "id": "MP028",
              "name": "no-rename-table",
              "shortDescription": {
                "text": "Renaming a table breaks all application queries, views, and foreign keys referencing the old name."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp028"
            },
            {
              "id": "MP029",
              "name": "ban-drop-not-null",
              "shortDescription": {
                "text": "Dropping NOT NULL allows NULL values in a previously non-nullable column. This may break application code that assumes the column is always populated."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp029"
            },
            {
              "id": "MP030",
              "name": "require-not-valid-check",
              "shortDescription": {
                "text": "Adding a CHECK constraint without NOT VALID scans the entire table under ACCESS EXCLUSIVE lock. Add with NOT VALID first, then VALIDATE separately."
              },
              "defaultConfiguration": {
                "level": "error"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp030"
            },
            {
              "id": "MP031",
              "name": "ban-exclusion-constraint",
              "shortDescription": {
                "text": "Adding an EXCLUSION constraint builds a GiST index and scans the entire table under ACCESS EXCLUSIVE lock. This cannot use NOT VALID."
              },
              "defaultConfiguration": {
                "level": "error"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp031"
            },
            {
              "id": "MP032",
              "name": "ban-cluster",
              "shortDescription": {
                "text": "CLUSTER rewrites the entire table under ACCESS EXCLUSIVE lock to match an index ordering. Use pg_repack instead."
              },
              "defaultConfiguration": {
                "level": "error"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp032"
            },
            {
              "id": "MP033",
              "name": "require-concurrent-refresh-matview",
              "shortDescription": {
                "text": "REFRESH MATERIALIZED VIEW without CONCURRENTLY takes ACCESS EXCLUSIVE lock, blocking all reads. Use CONCURRENTLY to allow reads during refresh."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp033"
            },
            {
              "id": "MP034",
              "name": "ban-drop-database",
              "shortDescription": {
                "text": "DROP DATABASE permanently destroys the entire database. This should never appear in a migration file."
              },
              "defaultConfiguration": {
                "level": "error"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp034"
            },
            {
              "id": "MP035",
              "name": "ban-drop-schema",
              "shortDescription": {
                "text": "DROP SCHEMA permanently removes the schema and potentially all objects within it. Use with extreme caution."
              },
              "defaultConfiguration": {
                "level": "error"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp035"
            },
            {
              "id": "MP036",
              "name": "ban-truncate-cascade",
              "shortDescription": {
                "text": "TRUNCATE CASCADE silently truncates all tables with foreign key references to the target. This can destroy data across many tables."
              },
              "defaultConfiguration": {
                "level": "error"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp036"
            },
            {
              "id": "MP037",
              "name": "prefer-text-over-varchar",
              "shortDescription": {
                "text": "VARCHAR(n) offers no performance benefit over TEXT in PostgreSQL and makes future schema changes harder."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp037"
            },
            {
              "id": "MP038",
              "name": "prefer-bigint-over-int",
              "shortDescription": {
                "text": "Primary key and foreign key columns using INT (4 bytes, max 2.1B) can overflow on high-traffic tables. Use BIGINT (8 bytes) instead."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp038"
            },
            {
              "id": "MP039",
              "name": "prefer-identity-over-serial",
              "shortDescription": {
                "text": "SERIAL/BIGSERIAL creates an implicit sequence with ownership quirks. Use GENERATED ALWAYS AS IDENTITY (PG 10+) instead."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp039"
            },
            {
              "id": "MP040",
              "name": "prefer-timestamptz",
              "shortDescription": {
                "text": "TIMESTAMP WITHOUT TIME ZONE loses timezone information, causing bugs when servers or users span time zones. Use TIMESTAMPTZ instead."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp040"
            },
            {
              "id": "MP041",
              "name": "ban-char-field",
              "shortDescription": {
                "text": "CHAR(n) pads values with spaces, wasting storage and causing subtle bugs in comparisons. Use TEXT or VARCHAR instead."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp041"
            },
            {
              "id": "MP042",
              "name": "require-index-name",
              "shortDescription": {
                "text": "CREATE INDEX without an explicit name generates auto-names that are hard to reference in future migrations and monitoring."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp042"
            },
            {
              "id": "MP043",
              "name": "ban-domain-constraint",
              "shortDescription": {
                "text": "Adding or modifying domain constraints validates against ALL columns using that domain, potentially scanning many tables."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp043"
            },
            {
              "id": "MP044",
              "name": "no-data-loss-type-narrowing",
              "shortDescription": {
                "text": "Changing a column to a narrower type can cause data loss or errors if existing values exceed the new type range."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp044"
            },
            {
              "id": "MP045",
              "name": "require-primary-key",
              "shortDescription": {
                "text": "Tables without a primary key cannot be efficiently replicated and make row identification ambiguous."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp045"
            },
            {
              "id": "MP046",
              "name": "require-concurrent-detach-partition",
              "shortDescription": {
                "text": "DETACH PARTITION without CONCURRENTLY takes ACCESS EXCLUSIVE lock on the parent, blocking all queries. Use CONCURRENTLY on PG 14+."
              },
              "defaultConfiguration": {
                "level": "error"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp046"
            },
            {
              "id": "MP047",
              "name": "ban-set-logged-unlogged",
              "shortDescription": {
                "text": "SET LOGGED/UNLOGGED rewrites the entire table under ACCESS EXCLUSIVE lock. This blocks all reads and writes for the duration."
              },
              "defaultConfiguration": {
                "level": "error"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp047"
            },
            {
              "id": "MP048",
              "name": "ban-alter-default-volatile-existing",
              "shortDescription": {
                "text": "Setting a volatile default (now(), random(), gen_random_uuid()) on an existing column has no effect on existing rows, which may cause confusion."
              },
              "defaultConfiguration": {
                "level": "warning"
              },
              "helpUri": "https://migrationpilot.dev/rules/mp048"
            }
          ]
        }
      },
      "results": [
        {
          "ruleId": "MP001",
          "ruleIndex": 0,
          "level": "error",
          "message": {
            "text": "CREATE INDEX \"idx_users_email\" without CONCURRENTLY will lock all writes on \"users\" for the entire duration of index creation."
          },
          "locations": [
            {
              "physicalLocation": {
                "artifactLocation": {
                  "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                },
                "region": {
                  "startLine": 1,
                  "startColumn": 1
                }
              }
            }
          ],
          "fixes": [
            {
              "description": {
                "text": "Safe alternative for MP001"
              },
              "artifactChanges": [
                {
                  "artifactLocation": {
                    "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                  },
                  "replacements": [
                    {
                      "deletedRegion": {
                        "startLine": 1
                      },
                      "insertedContent": {
                        "text": "-- Unsafe migration example\nCREATE INDEX CONCURRENTLY idx_users_email ON users (email)"
                      }
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "ruleId": "MP004",
          "ruleIndex": 3,
          "level": "error",
          "message": {
            "text": "DDL statement acquires SHARE lock without a preceding SET lock_timeout. Without a timeout, this statement could block the lock queue indefinitely if it can't acquire the lock, causing cascading query failures."
          },
          "locations": [
            {
              "physicalLocation": {
                "artifactLocation": {
                  "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                },
                "region": {
                  "startLine": 1,
                  "startColumn": 1
                }
              }
            }
          ],
          "fixes": [
            {
              "description": {
                "text": "Safe alternative for MP004"
              },
              "artifactChanges": [
                {
                  "artifactLocation": {
                    "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                  },
                  "replacements": [
                    {
                      "deletedRegion": {
                        "startLine": 1
                      },
                      "insertedContent": {
                        "text": "-- Set a timeout so DDL fails fast instead of blocking the queue\nSET lock_timeout = '5s';\n-- Unsafe migration example\nCREATE INDEX idx_users_email ON users (email)\nRESET lock_timeout;"
                      }
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "ruleId": "MP020",
          "ruleIndex": 16,
          "level": "warning",
          "message": {
            "text": "Long-running DDL without a preceding SET statement_timeout. This operation could hold locks for an extended time if it runs longer than expected."
          },
          "locations": [
            {
              "physicalLocation": {
                "artifactLocation": {
                  "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                },
                "region": {
                  "startLine": 1,
                  "startColumn": 1
                }
              }
            }
          ],
          "fixes": [
            {
              "description": {
                "text": "Safe alternative for MP020"
              },
              "artifactChanges": [
                {
                  "artifactLocation": {
                    "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                  },
                  "replacements": [
                    {
                      "deletedRegion": {
                        "startLine": 1
                      },
                      "insertedContent": {
                        "text": "-- Set a timeout so the operation is killed if it runs too long\nSET statement_timeout = '30s';\n-- Unsafe migration example\nCREATE INDEX idx_users_email ON users (email)\nRESET statement_timeout;"
                      }
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "ruleId": "MP023",
          "ruleIndex": 19,
          "level": "warning",
          "message": {
            "text": "CREATE INDEX \"idx_users_email\" without IF NOT EXISTS will fail if the index already exists. Use IF NOT EXISTS for idempotent migrations."
          },
          "locations": [
            {
              "physicalLocation": {
                "artifactLocation": {
                  "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                },
                "region": {
                  "startLine": 1,
                  "startColumn": 1
                }
              }
            }
          ],
          "fixes": [
            {
              "description": {
                "text": "Safe alternative for MP023"
              },
              "artifactChanges": [
                {
                  "artifactLocation": {
                    "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                  },
                  "replacements": [
                    {
                      "deletedRegion": {
                        "startLine": 1
                      },
                      "insertedContent": {
                        "text": "-- Unsafe migration example\nCREATE INDEX IF NOT EXISTS idx_users_email ON users (email)"
                      }
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "ruleId": "MP004",
          "ruleIndex": 3,
          "level": "error",
          "message": {
            "text": "DDL statement acquires ACCESS EXCLUSIVE lock without a preceding SET lock_timeout. Without a timeout, this statement could block the lock queue indefinitely if it can't acquire the lock, causing cascading query failures."
          },
          "locations": [
            {
              "physicalLocation": {
                "artifactLocation": {
                  "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                },
                "region": {
                  "startLine": 2,
                  "startColumn": 1
                }
              }
            }
          ],
          "fixes": [
            {
              "description": {
                "text": "Safe alternative for MP004"
              },
              "artifactChanges": [
                {
                  "artifactLocation": {
                    "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                  },
                  "replacements": [
                    {
                      "deletedRegion": {
                        "startLine": 2
                      },
                      "insertedContent": {
                        "text": "-- Set a timeout so DDL fails fast instead of blocking the queue\nSET lock_timeout = '5s';\nALTER TABLE orders ADD COLUMN total numeric DEFAULT 0\nRESET lock_timeout;"
                      }
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "ruleId": "MP004",
          "ruleIndex": 3,
          "level": "error",
          "message": {
            "text": "DDL statement acquires ACCESS EXCLUSIVE lock without a preceding SET lock_timeout. Without a timeout, this statement could block the lock queue indefinitely if it can't acquire the lock, causing cascading query failures."
          },
          "locations": [
            {
              "physicalLocation": {
                "artifactLocation": {
                  "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                },
                "region": {
                  "startLine": 3,
                  "startColumn": 1
                }
              }
            }
          ],
          "fixes": [
            {
              "description": {
                "text": "Safe alternative for MP004"
              },
              "artifactChanges": [
                {
                  "artifactLocation": {
                    "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                  },
                  "replacements": [
                    {
                      "deletedRegion": {
                        "startLine": 3
                      },
                      "insertedContent": {
                        "text": "-- Set a timeout so DDL fails fast instead of blocking the queue\nSET lock_timeout = '5s';\nALTER TABLE users ALTER COLUMN name TYPE varchar(50)\nRESET lock_timeout;"
                      }
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "ruleId": "MP007",
          "ruleIndex": 6,
          "level": "error",
          "message": {
            "text": "ALTER COLUMN TYPE on \"users\".\"name\" rewrites the entire table under ACCESS EXCLUSIVE lock, blocking all reads and writes."
          },
          "locations": [
            {
              "physicalLocation": {
                "artifactLocation": {
                  "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                },
                "region": {
                  "startLine": 3,
                  "startColumn": 1
                }
              }
            }
          ],
          "fixes": [
            {
              "description": {
                "text": "Safe alternative for MP007"
              },
              "artifactChanges": [
                {
                  "artifactLocation": {
                    "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                  },
                  "replacements": [
                    {
                      "deletedRegion": {
                        "startLine": 3
                      },
                      "insertedContent": {
                        "text": "-- Use the expand-contract pattern:\n-- Step 1: Add new column with desired type\nALTER TABLE users ADD COLUMN name_new <new_type>;\n\n-- Step 2: Backfill in batches\nUPDATE users SET name_new = name::<new_type>\n  WHERE id IN (SELECT id FROM users WHERE name_new IS NULL LIMIT 10000);\n\n-- Step 3: Create trigger to sync writes (during backfill)\n-- Step 4: Swap columns (brief lock)\n-- Step 5: Drop old column"
                      }
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "ruleId": "MP020",
          "ruleIndex": 16,
          "level": "warning",
          "message": {
            "text": "Long-running DDL without a preceding SET statement_timeout. This operation could hold locks for an extended time if it runs longer than expected."
          },
          "locations": [
            {
              "physicalLocation": {
                "artifactLocation": {
                  "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                },
                "region": {
                  "startLine": 3,
                  "startColumn": 1
                }
              }
            }
          ],
          "fixes": [
            {
              "description": {
                "text": "Safe alternative for MP020"
              },
              "artifactChanges": [
                {
                  "artifactLocation": {
                    "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                  },
                  "replacements": [
                    {
                      "deletedRegion": {
                        "startLine": 3
                      },
                      "insertedContent": {
                        "text": "-- Set a timeout so the operation is killed if it runs too long\nSET statement_timeout = '30s';\nALTER TABLE users ALTER COLUMN name TYPE varchar(50)\nRESET statement_timeout;"
                      }
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "ruleId": "MP004",
          "ruleIndex": 3,
          "level": "error",
          "message": {
            "text": "DDL statement acquires ACCESS EXCLUSIVE lock without a preceding SET lock_timeout. Without a timeout, this statement could block the lock queue indefinitely if it can't acquire the lock, causing cascading query failures."
          },
          "locations": [
            {
              "physicalLocation": {
                "artifactLocation": {
                  "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                },
                "region": {
                  "startLine": 4,
                  "startColumn": 1
                }
              }
            }
          ],
          "fixes": [
            {
              "description": {
                "text": "Safe alternative for MP004"
              },
              "artifactChanges": [
                {
                  "artifactLocation": {
                    "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                  },
                  "replacements": [
                    {
                      "deletedRegion": {
                        "startLine": 4
                      },
                      "insertedContent": {
                        "text": "-- Set a timeout so DDL fails fast instead of blocking the queue\nSET lock_timeout = '5s';\nVACUUM FULL users\nRESET lock_timeout;"
                      }
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "ruleId": "MP006",
          "ruleIndex": 5,
          "level": "error",
          "message": {
            "text": "VACUUM FULL on \"users\" rewrites the entire table under ACCESS EXCLUSIVE lock. This blocks ALL reads and writes for the entire duration."
          },
          "locations": [
            {
              "physicalLocation": {
                "artifactLocation": {
                  "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                },
                "region": {
                  "startLine": 4,
                  "startColumn": 1
                }
              }
            }
          ],
          "fixes": [
            {
              "description": {
                "text": "Safe alternative for MP006"
              },
              "artifactChanges": [
                {
                  "artifactLocation": {
                    "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                  },
                  "replacements": [
                    {
                      "deletedRegion": {
                        "startLine": 4
                      },
                      "insertedContent": {
                        "text": "-- Use pg_repack instead (no ACCESS EXCLUSIVE lock during rewrite):\n-- Install: CREATE EXTENSION pg_repack;\n-- Run: pg_repack --table users --no-superuser-check"
                      }
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "ruleId": "MP020",
          "ruleIndex": 16,
          "level": "warning",
          "message": {
            "text": "Long-running DDL without a preceding SET statement_timeout. This operation could hold locks for an extended time if it runs longer than expected."
          },
          "locations": [
            {
              "physicalLocation": {
                "artifactLocation": {
                  "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                },
                "region": {
                  "startLine": 4,
                  "startColumn": 1
                }
              }
            }
          ],
          "fixes": [
            {
              "description": {
                "text": "Safe alternative for MP020"
              },
              "artifactChanges": [
                {
                  "artifactLocation": {
                    "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                  },
                  "replacements": [
                    {
                      "deletedRegion": {
                        "startLine": 4
                      },
                      "insertedContent": {
                        "text": "-- Set a timeout so the operation is killed if it runs too long\nSET statement_timeout = '30s';\nVACUUM FULL users\nRESET statement_timeout;"
                      }
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "ruleId": "MP004",
          "ruleIndex": 3,
          "level": "error",
          "message": {
            "text": "DDL statement acquires ACCESS EXCLUSIVE lock without a preceding SET lock_timeout. Without a timeout, this statement could block the lock queue indefinitely if it can't acquire the lock, causing cascading query failures."
          },
          "locations": [
            {
              "physicalLocation": {
                "artifactLocation": {
                  "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                },
                "region": {
                  "startLine": 5,
                  "startColumn": 1
                }
              }
            }
          ],
          "fixes": [
            {
              "description": {
                "text": "Safe alternative for MP004"
              },
              "artifactChanges": [
                {
                  "artifactLocation": {
                    "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                  },
                  "replacements": [
                    {
                      "deletedRegion": {
                        "startLine": 5
                      },
                      "insertedContent": {
                        "text": "-- Set a timeout so DDL fails fast instead of blocking the queue\nSET lock_timeout = '5s';\nDROP TABLE legacy_data\nRESET lock_timeout;"
                      }
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "ruleId": "MP026",
          "ruleIndex": 22,
          "level": "error",
          "message": {
            "text": "DROP TABLE \"legacy_data\" permanently removes the table and all its data. This is irreversible and takes an ACCESS EXCLUSIVE lock."
          },
          "locations": [
            {
              "physicalLocation": {
                "artifactLocation": {
                  "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                },
                "region": {
                  "startLine": 5,
                  "startColumn": 1
                }
              }
            }
          ],
          "fixes": [
            {
              "description": {
                "text": "Safe alternative for MP026"
              },
              "artifactChanges": [
                {
                  "artifactLocation": {
                    "uri": "C:/Users/micke/Desktop/Money/migrationpilot/demo-unsafe.sql"
                  },
                  "replacements": [
                    {
                      "deletedRegion": {
                        "startLine": 5
                      },
                      "insertedContent": {
                        "text": "-- Step 1: Rename the table (keeps data as backup)\nALTER TABLE legacy_data RENAME TO legacy_data_deprecated;\n\n-- Step 2: After confirming no application depends on it, drop later\n-- DROP TABLE legacy_data_deprecated;"
                      }
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
Assertion failed: !(handle->flags & UV_HANDLE_CLOSING), file src\win\async.c, line 76
