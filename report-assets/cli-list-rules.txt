MigrationPilot — 48 safety rules (45 free, 3 pro)

  MP001 require-concurrent-index-creation [FREE] critical [auto-fix]
    CREATE INDEX without CONCURRENTLY blocks all writes on the target table for the entire duration of index creation.
  MP002 require-check-not-null-pattern [FREE] critical
    ALTER TABLE ... SET NOT NULL requires a full table scan to validate. Use the CHECK constraint pattern instead for large tables.
  MP003 volatile-default-table-rewrite [FREE] critical
    ADD COLUMN with a volatile DEFAULT (e.g., now(), random()) causes a full table rewrite on PG < 11, and still evaluates per-row on PG 11+.
  MP004 require-lock-timeout [FREE] critical [auto-fix]
    DDL operations should set lock_timeout to prevent blocking the lock queue indefinitely.
  MP005 require-not-valid-foreign-key [FREE] critical
    Adding a FK constraint without NOT VALID scans the entire table under ACCESS EXCLUSIVE lock.
  MP006 no-vacuum-full [FREE] critical
    VACUUM FULL rewrites the entire table under ACCESS EXCLUSIVE lock, blocking all reads and writes.
  MP007 no-column-type-change [FREE] critical
    ALTER COLUMN TYPE rewrites the entire table under ACCESS EXCLUSIVE lock. Use the expand-contract pattern instead.
  MP008 no-multi-ddl-transaction [FREE] critical
    Multiple DDL statements in a single transaction compound lock duration. Each DDL should run in its own transaction.
  MP009 require-drop-index-concurrently [FREE] warning [auto-fix]
    DROP INDEX without CONCURRENTLY acquires ACCESS EXCLUSIVE lock, blocking all reads and writes.
  MP010 no-rename-column [FREE] warning
    RENAME COLUMN breaks application queries referencing the old column name. Prefer adding a new column and migrating data.
  MP011 unbatched-data-backfill [FREE] warning
    UPDATE without a WHERE clause or LIMIT pattern rewrites the entire table in a single transaction, generating massive WAL and holding locks.
  MP012 no-enum-add-value-in-transaction [FREE] warning
    ALTER TYPE ... ADD VALUE cannot run inside a transaction block on PG < 12. Even on PG 12+, enum modifications take ACCESS EXCLUSIVE on the type.
  MP013 high-traffic-table-ddl [PRO] warning
    DDL on a table with high query traffic. Lock acquisition may be slow and cause cascading timeouts.
  MP014 large-table-ddl [PRO] warning
    DDL with long-held locks on a table with over 1M rows. Lock duration will scale with table size.
  MP015 no-add-column-serial [FREE] warning
    ADD COLUMN with SERIAL/BIGSERIAL creates implicit sequence and may rewrite table.
  MP016 require-index-on-fk [FREE] warning
    Foreign key columns should have an index to avoid sequential scans on cascading updates/deletes.
  MP017 no-drop-column [FREE] warning
    DROP COLUMN takes ACCESS EXCLUSIVE lock and may break running application code.
  MP018 no-force-set-not-null [FREE] warning
    SET NOT NULL without a pre-existing CHECK constraint scans the entire table under ACCESS EXCLUSIVE lock.
  MP019 no-exclusive-lock-high-connections [PRO] warning
    ACCESS EXCLUSIVE lock on a table with many active connections causes cascading timeouts.
  MP020 require-statement-timeout [FREE] warning [auto-fix]
    Long-running DDL should have a statement_timeout to prevent holding locks indefinitely.
  MP021 require-concurrent-reindex [FREE] warning
    REINDEX without CONCURRENTLY acquires ACCESS EXCLUSIVE lock (table) or SHARE lock (index), blocking queries. Use REINDEX CONCURRENTLY on PG 12+.
  MP022 no-drop-cascade [FREE] warning
    DROP ... CASCADE silently drops all dependent objects (views, foreign keys, policies). Always drop dependents explicitly.
  MP023 require-if-not-exists [FREE] warning
    CREATE TABLE/INDEX without IF NOT EXISTS will fail if the object already exists, making migrations non-idempotent.
  MP024 no-enum-value-removal [FREE] warning
    DROP TYPE destroys the enum and all columns using it. PostgreSQL has no ALTER TYPE ... DROP VALUE — removing enum values requires a full type recreation.
  MP025 ban-concurrent-in-transaction [FREE] critical
    CONCURRENTLY operations (CREATE INDEX, DROP INDEX, REINDEX) cannot run inside a transaction block. PostgreSQL will raise an ERROR at runtime.
  MP026 ban-drop-table [FREE] critical
    DROP TABLE permanently removes the table and all its data. Use with extreme caution in production.
  MP027 disallowed-unique-constraint [FREE] critical
    Adding a UNIQUE constraint directly scans the entire table under ACCESS EXCLUSIVE lock. Create the index concurrently first, then add the constraint USING INDEX.
  MP028 no-rename-table [FREE] warning
    Renaming a table breaks all application queries, views, and foreign keys referencing the old name.
  MP029 ban-drop-not-null [FREE] warning
    Dropping NOT NULL allows NULL values in a previously non-nullable column. This may break application code that assumes the column is always populated.
  MP030 require-not-valid-check [FREE] critical [auto-fix]
    Adding a CHECK constraint without NOT VALID scans the entire table under ACCESS EXCLUSIVE lock. Add with NOT VALID first, then VALIDATE separately.
  MP031 ban-exclusion-constraint [FREE] critical
    Adding an EXCLUSION constraint builds a GiST index and scans the entire table under ACCESS EXCLUSIVE lock. This cannot use NOT VALID.
  MP032 ban-cluster [FREE] critical
    CLUSTER rewrites the entire table under ACCESS EXCLUSIVE lock to match an index ordering. Use pg_repack instead.
  MP033 require-concurrent-refresh-matview [FREE] warning [auto-fix]
    REFRESH MATERIALIZED VIEW without CONCURRENTLY takes ACCESS EXCLUSIVE lock, blocking all reads. Use CONCURRENTLY to allow reads during refresh.
  MP034 ban-drop-database [FREE] critical
    DROP DATABASE permanently destroys the entire database. This should never appear in a migration file.
  MP035 ban-drop-schema [FREE] critical
    DROP SCHEMA permanently removes the schema and potentially all objects within it. Use with extreme caution.
  MP036 ban-truncate-cascade [FREE] critical
    TRUNCATE CASCADE silently truncates all tables with foreign key references to the target. This can destroy data across many tables.
  MP037 prefer-text-over-varchar [FREE] warning
    VARCHAR(n) offers no performance benefit over TEXT in PostgreSQL and makes future schema changes harder.
  MP038 prefer-bigint-over-int [FREE] warning
    Primary key and foreign key columns using INT (4 bytes, max 2.1B) can overflow on high-traffic tables. Use BIGINT (8 bytes) instead.
  MP039 prefer-identity-over-serial [FREE] warning
    SERIAL/BIGSERIAL creates an implicit sequence with ownership quirks. Use GENERATED ALWAYS AS IDENTITY (PG 10+) instead.
  MP040 prefer-timestamptz [FREE] warning
    TIMESTAMP WITHOUT TIME ZONE loses timezone information, causing bugs when servers or users span time zones. Use TIMESTAMPTZ instead.
  MP041 ban-char-field [FREE] warning
    CHAR(n) pads values with spaces, wasting storage and causing subtle bugs in comparisons. Use TEXT or VARCHAR instead.
  MP042 require-index-name [FREE] warning
    CREATE INDEX without an explicit name generates auto-names that are hard to reference in future migrations and monitoring.
  MP043 ban-domain-constraint [FREE] warning
    Adding or modifying domain constraints validates against ALL columns using that domain, potentially scanning many tables.
  MP044 no-data-loss-type-narrowing [FREE] warning
    Changing a column to a narrower type can cause data loss or errors if existing values exceed the new type range.
  MP045 require-primary-key [FREE] warning
    Tables without a primary key cannot be efficiently replicated and make row identification ambiguous.
  MP046 require-concurrent-detach-partition [FREE] critical
    DETACH PARTITION without CONCURRENTLY takes ACCESS EXCLUSIVE lock on the parent, blocking all queries. Use CONCURRENTLY on PG 14+.
  MP047 ban-set-logged-unlogged [FREE] critical
    SET LOGGED/UNLOGGED rewrites the entire table under ACCESS EXCLUSIVE lock. This blocks all reads and writes for the duration.
  MP048 ban-alter-default-volatile-existing [FREE] warning
    Setting a volatile default (now(), random(), gen_random_uuid()) on an existing column has no effect on existing rows, which may cause confusion.
